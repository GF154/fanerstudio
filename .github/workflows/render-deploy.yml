name: ğŸš€ Auto-Deploy to Render
run-name: Deploying Faner Studio to Render

on:
  push:
    branches:
      - master
      - main
  pull_request:
    branches:
      - master
      - main
  workflow_dispatch:
    inputs:
      environment:
        description: 'Deployment environment'
        required: false
        default: 'production'
        type: choice
        options:
          - production
          - staging

jobs:
  validate:
    name: ğŸ” Pre-deployment Validation
    runs-on: ubuntu-latest
    timeout-minutes: 5
    
    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4
      
      - name: ğŸ Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'
      
      - name: ğŸ“¦ Validate requirements.txt
        run: |
          if [ -f requirements.txt ]; then
            echo "âœ… requirements.txt found"
            echo "ğŸ“‹ Dependencies:"
            cat requirements.txt
            
            # Check for security vulnerabilities
            pip install safety
            safety check -r requirements.txt --continue-on-error || echo "âš ï¸ Security warnings found"
          else
            echo "âŒ requirements.txt not found"
            exit 1
          fi
      
      - name: ğŸ”§ Check main.py syntax
        run: |
          if [ -f main.py ]; then
            echo "âœ… main.py found"
            python -m py_compile main.py
            echo "âœ… Syntax validation passed"
          else
            echo "âŒ main.py not found"
            exit 1
          fi
      
      - name: ğŸ“Š Validation Summary
        if: success()
        run: |
          echo "âœ… All validation checks passed!"
          echo "ğŸš€ Ready for deployment"

  deploy:
    name: ğŸš€ Deploy to Render
    runs-on: ubuntu-latest
    needs: validate
    if: github.event_name != 'pull_request'
    timeout-minutes: 2
    
    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4
      
      - name: âœ… Deployment Success
        run: |
          echo ""
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "âœ… Code Validated & Ready!"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          echo "ğŸ“¦ Repository: ${{ github.repository }}"
          echo "ğŸ”€ Branch: ${{ github.ref_name }}"
          echo "ğŸ“ Commit: ${{ github.sha }}"
          echo "ğŸ‘¤ Author: ${{ github.actor }}"
          echo ""
          echo "ğŸš€ Render Auto-Deploy:"
          echo "   Render will automatically deploy via render.yaml"
          echo "   connected to your GitHub repository"
          echo ""
          echo "ğŸ“ Monitor Deployment:"
          echo "   https://dashboard.render.com"
          echo ""
          echo "ğŸŒ Service URL (after deploy):"
          echo "   https://fanerstudio-1.onrender.com"
          echo ""
          echo "â±ï¸  Deployment takes ~3-5 minutes"
          echo ""
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

